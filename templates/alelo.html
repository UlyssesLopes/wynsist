<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
        media="screen" title="no title">
    <link href="https://fonts.googleapis.com/css?family=Oswald" rel="stylesheet">

    {% load static %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/cartoes.css' %}">

    <title>WynColab</title>

    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">

    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2"
        crossorigin="anonymous"></script>

    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script type="text/javascript" src="//code.jquery.com/ui/1.11.3/jquery-ui.js"></script>

</head>

<body>

    <div class="col-12" align="center" style="margin-top: 100px;">
        <div class="col-6" style="height: 650px;">
            <h1 style="color: #f7f7f7;">Adicionar Cartão Alelo</h1>
            <h1 class="uppercase" style="color: #f7f7f7; font-size: 25px;">{{ colaboradores.nome }}</h1>

        </div>



    </div>

    <div class="gridContainer">

        <div class="creditCard">
            <div class="visaLogo aleloimg">
                {% load static %}
                <img src="{% static 'img/alelologo.png' %}" style="width: 150px; margin-right: 130px;">
            </div>
            <div class="chipLogo">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 230 384.4 300.4" width="50" height="90">
                    <path
                        d="M377.2 266.8c0 27.2-22.4 49.6-49.6 49.6H56.4c-27.2 0-49.6-22.4-49.6-49.6V107.6C6.8 80.4 29.2 58 56.4 58H328c27.2 0 49.6 22.4 49.6 49.6v159.2h-.4z"
                        data-original="#FFD66E" data-old_color="#00FF0C" fill="rgb(237,237,237)" />
                    <path
                        d="M327.6 51.2H56.4C25.2 51.2 0 76.8 0 107.6v158.8c0 31.2 25.2 56.8 56.4 56.8H328c31.2 0 56.4-25.2 56.4-56.4V107.6c-.4-30.8-25.6-56.4-56.8-56.4zm-104 86.8c.4 1.2.4 2 .8 2.4 0 0 0 .4.4.4.4.8.8 1.2 1.6 1.6 14 10.8 22.4 27.2 22.4 44.8s-8 34-22.4 44.8l-.4.4-1.2 1.2c0 .4-.4.4-.4.8-.4.4-.4.8-.8 1.6v74h-62.8v-73.2-.8c0-.8-.4-1.2-.4-1.6 0 0 0-.4-.4-.4-.4-.8-.8-1.2-1.6-1.6-14-10.8-22.4-27.2-22.4-44.8s8-34 22.4-44.8l1.6-1.6s0-.4.4-.4c.4-.4.4-1.2.4-1.6V64.8h62.8v72.4c-.4 0 0 .4 0 .8zm147.2 77.6H255.6c4-8.8 6-18.4 6-28.4 0-9.6-2-18.8-5.6-27.2h114.4v55.6h.4zM13.2 160H128c-3.6 8.4-5.6 17.6-5.6 27.2 0 10 2 19.6 6 28.4H13.2V160zm43.2-95.2h90.8V134c-4.4 4-8.4 8-12 12.8h-122V108c0-24 19.2-43.2 43.2-43.2zm-43.2 202v-37.6H136c3.2 4 6.8 8 10.8 11.6V310H56.4c-24-.4-43.2-19.6-43.2-43.2zm314.4 42.8h-90.8v-69.2c4-3.6 7.6-7.2 10.8-11.6h122.8v37.6c.4 24-18.8 43.2-42.8 43.2zm43.2-162.8h-122c-3.2-4.8-7.2-8.8-12-12.8V64.8h90.8c23.6 0 42.8 19.2 42.8 42.8v39.2h.4z"
                        data-original="#005F75" class="active-path" data-old_color="#005F75" fill="rgba(0,0,0,.4)" />
                </svg>
            </div>
            <ul class="ccList">
                <li style="font-size: 30px;"> </li>
            </ul>
            <h4 class="name" style="font-size: 22px;"> </h4>
            <h4 class="year" style="font-size: 22px;"> </h4>
        </div>
        
        <form action="submit" method="POST" class="oform" id="paymentForm">
            <h6 class="oh6">Cadastro de Cartão</h6>
            
            <div class="inputCon" id="name" data-top="Nome do Cartão">
                <input type="text" class="oinput" placeholder="Insira o nome" />
            </div>
            <div class="inputCon" id="cardNum" data-top="Número do Cartão" title="número do cartão com espaços">
                <input type="number" class="oinput" name="n_alelo" placeholder="4567 3456 3456 3456" />
            </div>
            <div class="inputCon" id="validYear" data-top="Validade">
                <input type="text" class="oinput" placeholder="09/20" />
            </div>
            <div class="inputCon" id="cvv" data-top="Valor Creditado" >
                <input type="text" class="oinput" name="v_alelo" placeholder="Valor R$" />
            </div>

            <input type="number" name="id_evento" value="{{colaboradores.id}}" hidden />
            {% csrf_token %}
            <button type="submit" class="button">Cadastrar</button>
        </form>
    </div>

</body>

<script>

    window.addEventListener("load", () => {
        // forms
        let inputs = document.querySelectorAll("input");
        let ccList = document.querySelectorAll(".ccList li");
        let name = document.querySelector(".name");
        let year = document.querySelector(".year");
        let inputCon = document.querySelectorAll(".inputCon");
        
        //credit card
        let cName = document.querySelector(".name");
        let cList = document.querySelector(".creditCard ul li");
        let cYear = document.querySelector(".creditCard .year");
        let length = inputs.length;
        let regExp = [/^[A-Za-z\'\s\.\,]+$/, /^4[0-9]{12}(?:[0-9]{3})?$/, /^[0-9]{3,4}$/];
        //focusing the text->function
        let fieldColor = (i) => {
            for (j = 0; j < inputCon.length; j++) {
                if (i == j) {
                    inputCon[i].style.color = "rgb(64,146,181)";
                }
                else {
                    inputCon[j].style.color = "rgb(193,193,193)";
                }
            }
        }
        let checkInput = (i) => {
            // Name
            if (i == 0) {
                if (inputs[0].value.match(regExp[0])) {
                    cName.innerText = inputs[0].value;
                    inputCon[0].style.color = "rgb(64,146,181)";
                    inputs[0].style.borderBottomColor = "rgb(64,146,181)";
                }
                else if (inputs[0].value == "" || !inputs[0].value.match(regExp[0])) {
                    cName.innerText = "";
                    inputs[0].style.borderBottomColor = "red";
                }
            }

            //CCard NUmber
            if (i == 1) {
                if (inputs[1].value == "") {
                    inputs[1].style.borderBottomColor = "red";
                    cList.innerText = " ";
                }
                else {
                    let cNumber = inputs[1].value;
                    cNumber = cNumber.replace(/\s/g, "");
                    if (Number(cNumber)) {
                        cNumber = cNumber.match(/.{1,4}/g);
                        cNumber = cNumber.join("");
                        inputs[1].value = cNumber;
                        if (cNumber.length <= 0) {
                            cList.innerText = "";
                        }
                        else if (cNumber.length > 19) {
                            cList.innerText = cNumber.substring(0, 20);
                            inputs[1].style.borderBottomColor = "red";

                        }
                        else {
                            cList.innerText = cNumber;
                            inputs[1].style.borderBottomColor = "rgb(64,146,181)";
                        }
                    }
                    else {
                        inputs[1].style.borderBottomColor = "red";
                    }
                }
            }
            // card Date
            else if (i == 2) {
                let dateValue = inputs[2].value;
                let d = dateValue.replace(/\s/g, "");
                // making sure its a number 
                if (Number(dateValue)) {
                    d = dateValue.split("").map((i) => {
                        return parseInt(i, 10);
                    }
                    );
                    let date = new Date();
                    let twoDigitYear = parseInt(date.getFullYear().toString().substr(2), 10);
                    //the first two digit in the month field
                    if (d.length == 2) {
                        //checking for first
                        if ((d[0] == 0 && (d[1] !== 0 || d[1] <= 9)) || d[0] == 1 && (d[1] <= 2)) {
                            inputs[2].style.borderBottomColor = "rgb(64,146,181)";
                            cYear.innerText = dateValue + "/";
                        }
                        else {
                            inputs[2].style.borderBottomColor = "red";

                        }
                    }//End of Month
                    else if (d.length == 4) {
                        let twoDigitYearN = parseInt(d[2].toString().concat(d[3].toString()), 10);
                        if (twoDigitYearN > twoDigitYear) {
                            let stringDigit = twoDigitYearN.toString();
                            cYear.innerText += stringDigit;
                            inputs[2].value = cYear.innerText;
                            inputs[2].style.borderBottomColor = "rgb(64,146,181)";
                        }
                        else {
                            inputs[2].style.borderBottomColor = "red";
                        }
                    }//End of date + full date
                }//END of IF for [i = 2]
                else {
                    cYear.innerText = "";
                    inputs[2].style.borderBottomColor = "red";
                }
            }

            if (i == 3) {
                let cV = inputs[i].value;
                if (Number(cV) && cV.match(regExp[2])) {
                    inputs[i].style.borderBottomColor = "rgb(64,146,181)";
                }
                else {
                    inputs[3].style.borderBottomColor = "red";
                }
            }
        }
        //setting value initially in the card to that of placeholder
        cName.innerText = inputs[0].getAttribute('placeholder');
        cList.innerText = inputs[1].getAttribute('placeholder');
        cYear.innerText = inputs[2].getAttribute('placeholder') //Adding Event Listeners
        for (i = 0; i < inputCon.length; i++) {
            inputs[i].addEventListener('click', fieldColor.bind(this, i));
            inputs[i].addEventListener('input', checkInput.bind(this, i));
        }
        btn.addEventListener('click', (e) => {
            e.preventDefault();
            for (i = 0; i < length; i++) {
                if (inputs[i].value == "") {
                    inputs[i].style.borderBottomColor = "red";
                }
            }
            if (cList.innerText.length < 16) {
                inputs[1].style.borderBottomColor = "red";
            }
        })
    });
</script>

</html>